---
title: "キャリブレーションの設定"
permalink: /make3d/calibration-settings/
toc: true
---
Kossel Mini EBには、Zプローブを使用してベッドの高さや傾きを自動的に補正する機能があります。ここでは、そのキャリブレーション機能を使うための設定をします。

以下が実際にキャリブレーションを行っている映像になります（Kossel Mini EBの右側から撮影しています）。

[![YouTube動画](http://img.youtube.com/vi/Bo-Tjs0jEXc/0.jpg)](https://youtu.be/Bo-Tjs0jEXc "Kossel Mini EB")

キャリブレーションでの動作内容を以下にまとめます。

1. ホットエンドを奥のフレーム（Z軸）のベルトの右側に移動する。
1. ホットエンドを左方向（マイナスX方向）に移動する。
1. プローブクリップを止めているM2.5-20ボルトをベルトに当てて回転させることでプローブをストッパーから外し、スプリングの力でプローブがノズル先端よりも下側にくるようにする。またこの時点でマイクロスイッチが入った状態になる。
1. ホットエンドを右方向に移動する。
1. ホットエンドをベッドの前方に移動する。
1. キャリブレーションを開始する。（プローブがベッドに到達するでホットエンドを下降し、マイクロスイッチが開放されたら上昇させるという動作を複数回、ベッド全体に実施する。）
1. ホットエンドをリトラクターの真上まで移動する。
1. ホットエンドを下降させ、安全ピンの誘導によりプローブをストッパーに乗せる。
1. 若干上昇して停止する。

キャリブレーションの設定を調整する必要がある点は３点あります。

- プローブの配備（デプロイ）
- プローブの収納（リトラクト）
- プローブとノズル先端の距離

それでは、実際にキャリブレーションの調整と実行をします。

Kossel Mini EBを電源に接続し、USBケーブルをPCに接続します。Arduino Softwareを起動し、Marlin.inoを開きます。Ponterfaceを起動します。「Connect」ボタンを押してKossel Mini EBに接続します。

※Arduino Softwareを使用する際は、PronterfaceがDisconnectの状態にする必要があります。

<figure>
  <img src="{{ '/assets/images/make3d/402/402-1.webp' | relative_url }}" alt="402-1">
</figure>

画面右下に入力フィールドに「G28」と入力して「Send」ボタンを押します。ホットエンドが上昇してホームポジションにつきます。Kossel Mini EBの電源を入れた直後はホットエンドの位置情報を持っていないため、キャリブレーションの前にかならず実行する必要があります。

※画面左側の操作パネルの左下に白家マークのボタンがありますが、これをクリックしてもG28コマンドと同じ動作をします。

これからキャリブレーションを実行しますが、その前に以下の２点を確認します。

- キャリブレーションのスタート時点では、プローブ（アルミ棒）はZプローブのストッパーに引っ掛かっていて、マイクロスイッチは押されていない状態である必要があります。ストッパーから外れいている場合はZプローブに引っ掛けておきます。
- ボトムボディー左側のアルミフレーム上にあるリトラクターを奥の方（Z軸寄り）に移動させておきます。

フィールドに「G29」と入力して「Send」ボタンを押して、キャリブレーションを開始します。プローブが配備（プローブがストッパーから外れてマイクロスイッチを押している状態）されなかったとしても、このまま最後まで続けます。

キャリブレーション終了後、プローブが配備されているか確認します。もし配備されていなければ、手を使ってストッパーから外します。リトラクターを移動させて、円柱がちょうどプローブの真下にくる位置に調整し、ボルトを締めます。

以下、それぞれの場合の調整方法を示します。

## 【プローブの配備がされなかった場合】

ベルトにプローブのボルトが正常に当たっていない事が考えられます。調整方法は２種類あります。

１．プローブのボルトの方向を調整する。

基本的には、プローブ上部のL字短辺部分の方向とボルトの方向は平行にしますが、ベルトへの当たりを強くするために、ボルトの方向を若干反時計回り方向にずらす事でストッパーから外れやすくなります。

２．移動距離を増やす。

ホットエンドの移動距離は設定値で決められています。この距離を変更することで、ベルトへの当たりを強くします。Arduino Softwareから、Marlin_main.cppファイルを開きます。1033行目の「destination[X_AXIS] = 0;」は、ホットエンドをX:0の位置まで移動させて、ボルトをベルトに当てる事を示しています。このゼロ値をマイナス値に変更する事で移動距離が増え、よりベルトへの当たりが強くなります。単位はmmです。少しずつ値を変えて、確実にデプロイされる様に調整します。

<figure>
  <img src="{{ '/assets/images/make3d/402/402-2.webp' | relative_url }}" alt="402-2">
</figure>

上記以外にも、プローブがスムーズに外れない場合などの原因が考えられますので、安全ピンの形状を変えてみるのも有効かもしれません。

## 【プローブが収納されなかった場合】

プローブ収納時にホットエンドの下降量が少ない事が考えられます。この下降量を増やしてみます。Arduino Softwareから、Marlin_main.cppファイルを開きます。1078行目の「destination[Z_AXIS] = current_position[Z_AXIS] - 20;」は、現在位置から20mm降下させる事を示してます。この「20」を増やすことで降下量が多くなり、ストッパーに引っ掛かり易くなります。

<figure>
  <img src="{{ '/assets/images/make3d/402/402-3.webp' | relative_url }}" alt="402-3">
</figure>

上記以外にも、プローブがスムーズにストッパーに移動していない場合などの原因が考えられますので、安全ピンの形状を変えてみるだとか、プローブL字短辺の下側をヤスリで平坦にするなども有効かもしれません。

キャリブレーションの一連の動作が安定したら、プローブとノズル先端の距離の設定を調整します。

キャリブレーションが終了した状態にします。G28コマンドなどで一度ホームポジションへ戻ると、キャリブレーションの取得値が消去されてしまいますので、その場合は再度キャリブレーションを実行して下さい。

フィールドに「G0 X0 Y0 F3500」と入力して「Send」ボタンを押します。ホットエンドが同じ高さで中央に移動します。

※画面左側の操作パネルの中央にある赤丸のボタンをクリックしてもこのコマンドと同じ動作をします。

初期設定のZ値補正と同様、ベッドの上にコピー用紙を置き、ノズルとコピー用紙が接触し、コピー用紙を引いたり押したりすると適当な抵抗感が感じられるまで下降させます。

※ベッドまでの距離がある場合、最初に「G0 Z5 F3500」などを実行してホットエンドをベッド近くへ移動させてから、操作パネルのボタンを使った方が早くできます。

※ノズルがコピー用紙に接触する前に降下が止まってしまった場合については、下記の※印を参照してください。

M114コマンドで位置（Z値）を確認します。Arduino SoftwareからConfiguration.hファイルを開きます。390行目の「Z_PROBE_OFFSET_FROM_EXTRUDER」の値は、ノズル先端をゼロとしてプローブ先端までの距離を示しています。通常マイナス値を取ります。M114コマンドで確認したZ値（プラス値）を現在の設定値に加算します。（例：Z値が1.1の場合、-7.7 + 1.1 = -6.6へ変更）

<figure>
  <img src="{{ '/assets/images/make3d/402/402-4.webp' | relative_url }}" alt="402-4">
</figure>

※ノズルがコピー用紙に接触する前に降下が止まってしまった場合、M114コマンドでZ値を確認するとゼロになっていると思います。この場合は、「Z_PROBE_OFFSET_FROM_EXTRUDER」値をマイナス方向へ大きくします。（例：「Z_PROBE_OFFSET_FROM_EXTRUDER」値が-7.7の場合、-8.7へ変更）

設定を変更したら、ファームウェアの書き込みを行い、再度G28コマンドおよびG29コマンドを実行して再度キャリブレーションを行います。

Z位置がゼロになるまで下降させた時、ノズルとコピー用紙が接触し、コピー用紙を引いたり押したりすると適当な抵抗が感じられる状態であれば調整完了です。

キャリブレーションの使い方ですが、スライサーの設定において、プレフィックスにG29コマンドを記述しておくと、3Dプリント開始時、自動的にキャリブレーションが実行される様になります。
